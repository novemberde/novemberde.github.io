<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Node 서버를 바탕으로 Dockerfile로 만들기 | Novemberde's Blog</title>
<meta name=keywords content="dockerfile,docker,nodejs,node"><meta name=description content="Summary Dockerfile로 이미지로 관리하면 배포 및 관리가 간편하게 가능하다. 여기서는 node를 베이스 이미지로하여 노드 서버를 배포할 수 있도록 준비한다.
순서 Amazon web service에 Ubuntu OS를 사용하는 EC2 인스턴스 생성하기 접속 포트를 열어주고 별도의 Ubuntu 유저를 생성하기 EC2에 Docker를 설치하고 Ubuntu 유저에게 권한주기 Bitbucket을 사용하여 git repository 생성하기 Express JS를 사용하여 Node 서버 구축하기 PM2를 사용하여 EC2에 Node 서버 배포하기 Node 서버를 바탕으로 Dockerfile로 만들기 Docker Hub의 automated build를 사용하여 Docker image를 만들기 만들어진 Docker image를 EC2 인스턴스에 배포하기 Dockerfile 이란?"><meta name=author content><link rel=canonical href=https://novemberde.github.io/post/2017/04/02/Docker_7/><link crossorigin=anonymous href=/assets/css/stylesheet.min.9f1d947375927e9847272b1f4e9be81336f539e513bf04d52cade31f81cad1af.css integrity="sha256-nx2Uc3WSfphHJysfTpvoEzb1OeUTvwTVLK3jH4HK0a8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.30d2332871da51f600f574811c17751e6c862577d450b624f86e2bc8a6e31221.js integrity="sha256-MNIzKHHaUfYA9XSBHBd1HmyGJXfUULYk+G4ryKbjEiE=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://novemberde.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://novemberde.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://novemberde.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://novemberde.github.io/apple-touch-icon.png><link rel=mask-icon href=https://novemberde.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.122.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-9SF4VDQ4N0"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9SF4VDQ4N0",{anonymize_ip:!1})}</script><meta property="og:title" content="Node 서버를 바탕으로 Dockerfile로 만들기"><meta property="og:description" content="Summary Dockerfile로 이미지로 관리하면 배포 및 관리가 간편하게 가능하다. 여기서는 node를 베이스 이미지로하여 노드 서버를 배포할 수 있도록 준비한다.
순서 Amazon web service에 Ubuntu OS를 사용하는 EC2 인스턴스 생성하기 접속 포트를 열어주고 별도의 Ubuntu 유저를 생성하기 EC2에 Docker를 설치하고 Ubuntu 유저에게 권한주기 Bitbucket을 사용하여 git repository 생성하기 Express JS를 사용하여 Node 서버 구축하기 PM2를 사용하여 EC2에 Node 서버 배포하기 Node 서버를 바탕으로 Dockerfile로 만들기 Docker Hub의 automated build를 사용하여 Docker image를 만들기 만들어진 Docker image를 EC2 인스턴스에 배포하기 Dockerfile 이란?"><meta property="og:type" content="article"><meta property="og:url" content="https://novemberde.github.io/post/2017/04/02/Docker_7/"><meta property="article:section" content="post"><meta property="article:published_time" content="2017-04-02T11:30:03+00:00"><meta property="article:modified_time" content="2017-04-02T11:30:03+00:00"><meta property="og:site_name" content="Novemberde dev logs"><meta name=twitter:card content="summary"><meta name=twitter:title content="Node 서버를 바탕으로 Dockerfile로 만들기"><meta name=twitter:description content="Summary Dockerfile로 이미지로 관리하면 배포 및 관리가 간편하게 가능하다. 여기서는 node를 베이스 이미지로하여 노드 서버를 배포할 수 있도록 준비한다.
순서 Amazon web service에 Ubuntu OS를 사용하는 EC2 인스턴스 생성하기 접속 포트를 열어주고 별도의 Ubuntu 유저를 생성하기 EC2에 Docker를 설치하고 Ubuntu 유저에게 권한주기 Bitbucket을 사용하여 git repository 생성하기 Express JS를 사용하여 Node 서버 구축하기 PM2를 사용하여 EC2에 Node 서버 배포하기 Node 서버를 바탕으로 Dockerfile로 만들기 Docker Hub의 automated build를 사용하여 Docker image를 만들기 만들어진 Docker image를 EC2 인스턴스에 배포하기 Dockerfile 이란?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://novemberde.github.io/post/"},{"@type":"ListItem","position":2,"name":"Node 서버를 바탕으로 Dockerfile로 만들기","item":"https://novemberde.github.io/post/2017/04/02/Docker_7/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Node 서버를 바탕으로 Dockerfile로 만들기","name":"Node 서버를 바탕으로 Dockerfile로 만들기","description":"Summary Dockerfile로 이미지로 관리하면 배포 및 관리가 간편하게 가능하다. 여기서는 node를 베이스 이미지로하여 노드 서버를 배포할 수 있도록 준비한다.\n순서 Amazon web service에 Ubuntu OS를 사용하는 EC2 인스턴스 생성하기 접속 포트를 열어주고 별도의 Ubuntu 유저를 생성하기 EC2에 Docker를 설치하고 Ubuntu 유저에게 권한주기 Bitbucket을 사용하여 git repository 생성하기 Express JS를 사용하여 Node 서버 구축하기 PM2를 사용하여 EC2에 Node 서버 배포하기 Node 서버를 바탕으로 Dockerfile로 만들기 Docker Hub의 automated build를 사용하여 Docker image를 만들기 만들어진 Docker image를 EC2 인스턴스에 배포하기 Dockerfile 이란?","keywords":["dockerfile","docker","nodejs","node"],"articleBody":"Summary Dockerfile로 이미지로 관리하면 배포 및 관리가 간편하게 가능하다. 여기서는 node를 베이스 이미지로하여 노드 서버를 배포할 수 있도록 준비한다.\n순서 Amazon web service에 Ubuntu OS를 사용하는 EC2 인스턴스 생성하기 접속 포트를 열어주고 별도의 Ubuntu 유저를 생성하기 EC2에 Docker를 설치하고 Ubuntu 유저에게 권한주기 Bitbucket을 사용하여 git repository 생성하기 Express JS를 사용하여 Node 서버 구축하기 PM2를 사용하여 EC2에 Node 서버 배포하기 Node 서버를 바탕으로 Dockerfile로 만들기 Docker Hub의 automated build를 사용하여 Docker image를 만들기 만들어진 Docker image를 EC2 인스턴스에 배포하기 Dockerfile 이란? Docker image의 설정 정보를 담고 있는 파일이다. 실제 운영 소프트웨어를 배포할 경우 node 베이스 이미지를 올린 다음 패키지를 설치하고 volume을 할당할 수도 있다. 현재 이미지를 주기적으로 commit하여 백업하고 직접 docker exec를 하여 컨테이너 내에 실행명령어를 보내야하는 단점이 있었다. 하지만 Dockerfile은 docker image를 생성할 때 source file을 가져와서 컨테이너 구동과 동시에 서버를 가동시킬 수 있다. 이러한 docker container를 관리하는 방법으로는 docker-compose가 있는데 추후에 살펴볼 것이다.\nDockerfile 작성하기 https://hub.docker.com/에서 여러 베이스 이미지를 검색해볼 수 있다. 예를 들어 node 를 검색한다고 하자. 아래와 같은 화면을 볼 수 있을 것이다.\n맨 위의 node를 들어가면 Full Description에서 “7.8.0, 7.8, 7, latest (7.8/Dockerfile)“과 같은 글이 보일 것이다.\n여기에 들어가면 Dockerfile이 어떻게 구성되어 있는지 확인할 수 있다.\nFROM : 베이스 이미지 RUN : 실행 커맨드 라인 ENV : 설정할 환경변수 CMD : 데몬으로 실행할 명령어 VOLUME : 호스트와 컨테이너의 디렉터리 공유 COPY : 호스트에서 가져올 디렉터리 또는 파일 EXPOSE : 노출할 포트 설정 간단히 Dockerfile의 구성에 대해서 살펴봤으니 Dockerfile을 만들어보자.\n우리가 만들 이미지의 구성은 아래와 같다\n베이스이미지 : node 실행할 커맨드라인 : npm install -g pm2 환경변수 : NODE_ENV=production 데몬으로 실행할 명령어 : node app.js 호스트에서 가져올 디렉터리 또는 파일 : /home/docker/docker_node_server 노출할 포트: 80 만든 Dockerfile을 배포할 node js 서버 패키지에 만들자.\nDockerfile은 별도의 확장자가 없다.\n파일 트리 구조는 아래와 같다.\n├ docker_node_server ├ app.js ├ Dockerfile └ package.json Dockerfile은 아래와 같다.\n{% gist novemberde/ff49bcb8cbe9f1bab15220ae68b92a69 %}\n만들어진 Dockerfile을 빌드해보자\n# 현재 폴더를 중심으로 한다. docker build -t my-node ./ build가 성공하면 git 에 push해주자. References https://hub.docker.com/ ","wordCount":"320","inLanguage":"en","datePublished":"2017-04-02T11:30:03Z","dateModified":"2017-04-02T11:30:03Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://novemberde.github.io/post/2017/04/02/Docker_7/"},"publisher":{"@type":"Organization","name":"Novemberde's Blog","logo":{"@type":"ImageObject","url":"https://novemberde.github.io/favicon.ico"}}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8620431066400094" crossorigin=anonymous></script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://novemberde.github.io/ accesskey=h title="Novemberde's Blog (Alt + H)">Novemberde's Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://novemberde.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://novemberde.github.io/post/ title=Post><span>Post</span></a></li><li><a href=https://novemberde.github.io/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://novemberde.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://novemberde.github.io/post/>Posts</a></div><h1 class=post-title>Node 서버를 바탕으로 Dockerfile로 만들기</h1><div class=post-meta>April 2, 2017 2 min</div></header><div class=post-content><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><hr><p>Dockerfile로 이미지로 관리하면 배포 및 관리가 간편하게 가능하다.
여기서는 node를 베이스 이미지로하여 노드 서버를 배포할 수 있도록 준비한다.</p><hr><h2 id=순서>순서<a hidden class=anchor aria-hidden=true href=#순서>#</a></h2><hr><ol><li>Amazon web service에 Ubuntu OS를 사용하는 EC2 인스턴스 생성하기</li><li>접속 포트를 열어주고 별도의 Ubuntu 유저를 생성하기</li><li>EC2에 Docker를 설치하고 Ubuntu 유저에게 권한주기</li><li>Bitbucket을 사용하여 git repository 생성하기</li><li>Express JS를 사용하여 Node 서버 구축하기</li><li>PM2를 사용하여 EC2에 Node 서버 배포하기</li><li>Node 서버를 바탕으로 Dockerfile로 만들기</li><li>Docker Hub의 automated build를 사용하여 Docker image를 만들기</li><li>만들어진 Docker image를 EC2 인스턴스에 배포하기</li></ol><hr><h2 id=dockerfile-이란>Dockerfile 이란?<a hidden class=anchor aria-hidden=true href=#dockerfile-이란>#</a></h2><hr><p>Docker image의 설정 정보를 담고 있는 파일이다.
실제 운영 소프트웨어를 배포할 경우 node 베이스 이미지를 올린 다음 패키지를 설치하고 volume을 할당할 수도 있다.
현재 이미지를 주기적으로 commit하여 백업하고 직접 docker exec를 하여 컨테이너 내에 실행명령어를 보내야하는 단점이 있었다.
하지만 Dockerfile은 docker image를 생성할 때 source file을 가져와서 컨테이너 구동과 동시에 서버를 가동시킬 수 있다.
이러한 docker container를 관리하는 방법으로는 docker-compose가 있는데 추후에 살펴볼 것이다.</p><hr><h2 id=dockerfile-작성하기>Dockerfile 작성하기<a hidden class=anchor aria-hidden=true href=#dockerfile-작성하기>#</a></h2><hr><p><a href=https://hub.docker.com/>https://hub.docker.com/</a>에서 여러 베이스 이미지를 검색해볼 수 있다.
예를 들어 node 를 검색한다고 하자. 아래와 같은 화면을 볼 수 있을 것이다.</p><p><img loading=lazy src=/images/aws/ec2/docker_hub.png alt=docker_hub></p><hr><p>맨 위의 node를 들어가면 Full Description에서 &ldquo;7.8.0, 7.8, 7, latest (7.8/Dockerfile)&ldquo;과 같은 글이 보일 것이다.</p><p>여기에 들어가면 Dockerfile이 어떻게 구성되어 있는지 확인할 수 있다.</p><ul><li>FROM : 베이스 이미지</li><li>RUN : 실행 커맨드 라인</li><li>ENV : 설정할 환경변수</li><li>CMD : 데몬으로 실행할 명령어</li><li>VOLUME : 호스트와 컨테이너의 디렉터리 공유</li><li>COPY : 호스트에서 가져올 디렉터리 또는 파일</li><li>EXPOSE : 노출할 포트 설정</li></ul><p><img loading=lazy src=/images/aws/ec2/docker_hub_detail.png alt=docker_hub_detail>
<img loading=lazy src=/images/aws/ec2/dockerfile_node.png alt=dockerfile_node></p><hr><p>간단히 Dockerfile의 구성에 대해서 살펴봤으니 Dockerfile을 만들어보자.</p><p>우리가 만들 이미지의 구성은 아래와 같다</p><ul><li>베이스이미지 : node</li><li>실행할 커맨드라인 : npm install -g pm2</li><li>환경변수 : NODE_ENV=production</li><li>데몬으로 실행할 명령어 : node app.js</li><li>호스트에서 가져올 디렉터리 또는 파일 : /home/docker/docker_node_server</li><li>노출할 포트: 80</li></ul><p>만든 Dockerfile을 배포할 node js 서버 패키지에 만들자.</p><p>Dockerfile은 별도의 확장자가 없다.</p><p>파일 트리 구조는 아래와 같다.</p><pre tabindex=0><code>
├ docker_node_server
    ├ app.js
    ├ Dockerfile
    └ package.json
</code></pre><p>Dockerfile은 아래와 같다.</p><p>{% gist novemberde/ff49bcb8cbe9f1bab15220ae68b92a69 %}</p><hr><p>만들어진 Dockerfile을 빌드해보자</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 현재 폴더를 중심으로 한다.</span>
</span></span><span style=display:flex><span>docker build -t my-node ./
</span></span></code></pre></div><hr><h2 id=build가-성공하면-git-에-push해주자>build가 성공하면 git 에 push해주자.<a hidden class=anchor aria-hidden=true href=#build가-성공하면-git-에-push해주자>#</a></h2><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://hub.docker.com/>https://hub.docker.com/</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://novemberde.github.io/tags/dockerfile/>dockerfile</a></li><li><a href=https://novemberde.github.io/tags/docker/>docker</a></li><li><a href=https://novemberde.github.io/tags/nodejs/>nodejs</a></li><li><a href=https://novemberde.github.io/tags/node/>node</a></li></ul><nav class=paginav><a class=prev href=https://novemberde.github.io/post/2017/04/02/Docker_8/><span class=title>« Prev Page</span><br><span>Docker Hub의 automated build를 사용하여 Docker image를 만들기</span>
</a><a class=next href=https://novemberde.github.io/post/2017/04/02/Docker_6/><span class=title>Next Page »</span><br><span>PM2를 사용하여 EC2에 Node 서버 배포하기</span></a></nav></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//novemberde-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://novemberde.github.io/>Novemberde's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>